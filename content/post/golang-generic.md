---
title: "Go Generic"
date: 2023-01-23T19:50:59+08:00
categories : [
"Go",
"Programming",
]
tags : [
"Go",
"Generic"
]
---

## å…³äº Go è¯­è¨€æ³›å‹çš„ä¸€äº›å­¦ä¹ å’Œç†è§£

### åºè¨€

2022å¹´3æœˆ15æ—¥ï¼Œäº‰è®®éå¸¸å¤§ä½†åŒæ—¶ä¹Ÿå¤‡å—æœŸå¾…çš„æ³›å‹ç»ˆäºä¼´éšç€ Go 1.18 å‘å¸ƒäº†ã€‚~~è®¾ç½®è€…ä¹‹å‰è¿˜è¯´ä¸ºäº† Go è¯­è¨€çš„ç®€æ´ï¼Œä¸ä¼šåŠ å…¥æ³›å‹~~

### ä¸ºä»€ä¹ˆè¦å¼•å…¥æ³›å‹

åœ¨ 1.18 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœæƒ³åœ¨ Go è¯­è¨€ä¸­è®©ä¸€ä¸ªå‡½æ•°/æ–¹æ³•æ”¯æŒå¤šç§ç±»å‹ï¼Œé‚£ä¹ˆå¼€å‘è€…åªèƒ½ä¸ºæ¯ä¸ªç±»å‹æŒ¨ä¸ªå®ç°ç›¸å…³çš„å‡½æ•°/æ–¹æ³•ã€‚æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ª Add å‡½æ•°ï¼Œå®šä¹‰å¦‚ä¸‹

```go
func Add(a, b int) int {
    return a + b
}
```

ä½†æ˜¯ä¸Šé¢çš„å‡½æ•°åªæ”¯æŒ int ç±»å‹ï¼Œå¦‚æœæˆ‘æƒ³æ”¯æŒå…¶ä»–ç±»å‹é‚£ä¹ˆéœ€è¦åœ¨å®šä¹‰å…¶ä»–ç±»å‹çš„å‡½æ•°ï¼Œå¦‚ä¸‹

```go
func AddFloat32(a, b float32) float32 {
    return a + b
}

func AddFloat64(a, b float64) float64 {
    return a + b
}
```

è¿™ä¹Ÿå¤ªéº»çƒ¦äº†å§ï¼ŒğŸŒ¿

ä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ ç©ºæ¥å£ `interface{}` åŠ åå°„çš„æ–¹å¼å®ç°ï¼ˆç°åœ¨ç©ºæ¥å£è¢«åŒ…è£…ä¸º `any` å…³é”®å­—ï¼‰ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥å®ç°ã€‚~~è¿™ä¸æ˜¯æ›´éº»çƒ¦å—~~

```go
func Process(x any) {
    t := reflect.TypeOf(x)
    v := reflect.ValueOf(x)
    switch t.Kind() {
    case reflect.Int:
        fmt.Println("x is an int with value", v.Int())
    case reflect.String:
        fmt.Println("x is a string with value", v.String())
    case reflect.Float64:
        fmt.Println("x is a float64 with value", v.Float())
    default:
        fmt.Println("x is of unknown type")
    }
}
```

ä½†æ˜¯è¿™ç§å®ç°æ–¹æ³•æœ‰å¾ˆå¤šé—®é¢˜ï¼š

       1. ç”¨èµ·æ¥å¾ˆéº»çƒ¦ï¼Œåæ­£ go è¯­è¨€çš„åå°„æˆ‘æ˜¯æ²¡æ€ä¹ˆå†™æ˜ç™½
       2. ç¼ºå°‘äº†ç¼–è¯‘æ—¶çš„ç±»å‹æ£€æŸ¥ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ï¼Œè¿™å¯¹äºæˆ‘ä»¬å®ç°çš„åº”ç”¨æ¥è¯´æ˜¯å¾ˆè‡´å‘½çš„
       3. æ€§èƒ½ä¸ç†æƒ³ï¼Œå› ä¸ºåå°„æ˜¯è¿è¡Œæ—¶çš„ä¸œè¥¿

è€Œåœ¨æ³›å‹é€‚ç”¨çš„æ—¶å€™ï¼Œå®ƒèƒ½è§£å†³ä¸Šé¢è¿™äº›é—®é¢˜ã€‚ä½†è¿™ä¹Ÿä¸æ„å‘³ç€æ³›å‹æ˜¯ä¸‡é‡‘æ²¹ï¼Œæ³›å‹æœ‰ç€è‡ªå·±çš„é€‚ç”¨åœºæ™¯ï¼Œå½“ä½ ç–‘æƒ‘æ˜¯ä¸æ˜¯è¯¥ç”¨æ³›å‹çš„è¯ï¼Œè¯·è®°ä½ä¸‹é¢è¿™æ¡ç»éªŒï¼š

> å¦‚æœä½ ç»å¸¸è¦åˆ†åˆ«ä¸ºä¸åŒçš„ç±»å‹å†™å®Œå…¨ç›¸åŒé€»è¾‘çš„ä»£ç ï¼Œé‚£ä¹ˆä½¿ç”¨æ³›å‹å°†æ˜¯æœ€åˆé€‚çš„é€‰æ‹©

### Go çš„æ³›å‹

Go è¯­è¨€å¼•å…¥äº†å¦‚ä¸‹çš„æ–°æ¦‚å¿µæ¥å®ç°æ³›å‹

- ç±»å‹å½¢å‚ï¼ˆType parameterï¼‰
- ç±»å‹å®å‚ï¼ˆType argumentï¼‰
- ç±»å‹å½¢å‚åˆ—è¡¨ï¼ˆType parameter listï¼‰
- ç±»å‹çº¦æŸï¼ˆType constraintï¼‰
- å®ä¾‹åŒ–ï¼ˆInstantiationsï¼‰
- æ³›å‹ç±»å‹ï¼ˆGeneric typeï¼‰
- æ³›å‹æ¥æ”¶å™¨ï¼ˆGeneric receiverï¼‰
- æ³›å‹å‡½æ•°ï¼ˆGeneric functionï¼‰

ç­‰ç­‰ç­‰ç­‰. . .è¿™ TM ä¹Ÿå¤ªå¤šäº†å§ï¼Œä¸‹é¢æ¥ä¸€ä¸ªä¸ªä»‹ç»ä¸€ä¸‹

#### ç±»å‹å½¢å‚ã€ç±»å‹å®å‚ã€ç±»å‹çº¦æŸå’Œæ³›å‹ç±»å‹

åœ¨ 1.18 ä¹‹å‰ï¼ŒNewType ä¸€èˆ¬åªå…è®¸æœ‰ä¸€ä¸ªç±»å‹ï¼Œä¾‹å¦‚

```go
type IntSlice []int

var a IntSlice = []int{1, 2, 3}
var a IntSlice = []float64(1.o, 2.0, 3.0) // error å› ä¸º IntSlice åº•å±‚ä¸º []int
```

é‚£æˆ‘æƒ³è¦ä¸€ä¸ªå¯ä»¥å®¹çº³å…¶ä»–ç±»å‹çš„åˆ‡ç‰‡æ€ä¹ˆåŠï¼Ÿç®€å•ï¼Œå¯¹åº”çš„æ¯ä¸ªç±»å‹å†™ä¸€ä¸ªå°±è¡Œ~~ğŸŒ¿~~

```go
type Float32Slice []float32
type Float64Slice []float64
type StringSlice []string
```

æ³›å‹çš„å¼•å…¥å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œå³

```go
type Slice[T int | float32 | float64 | string] []T
```

ä¸åŒäºå…¶ä»–è¯­è¨€çš„æ³›å‹ä½¿ç”¨å°–æ‹¬å·`<>`ï¼ŒGoè¯­è¨€ä¸ºäº†ç¼–è¯‘å™¨çš„ç®€å•ï¼ˆä¸æ˜¯æˆ‘è¯´çš„ï¼‰ä½¿ç”¨äº†æ–¹æ‹¬å·`[]` ~~ä¹ŸæŒºåäººç±»çš„~~

å¯¹äºä»¥ä¸Šä¸ªå„éƒ¨åˆ†å¯¹åº”çš„æ¦‚å¿µå¦‚ä¸‹

- `T` ä¸º**ç±»å‹å½¢å‚**ï¼Œåœ¨å®šä¹‰ Slice çš„ç±»å‹æ—¶ä¸ä»£è¡¨å…·ä½“çš„ç±»å‹ï¼Œåªä½œä¸ºä¸€ä¸ªå ä½ç¬¦
- `int | float32 | float64 | string` ä¸º**ç±»å‹çº¦æŸ**ï¼Œä¸­é—´çš„`|`å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘åªæ¥å—è¿™å››ç§ç±»å‹çš„å®å‚
- ä¸­æ‹¬å·é‡Œçš„`[T int | float32 | float64 | string]`ä¸€æ•´ä¸²å› ä¸ºå®šä¹‰äº†æ‰€æœ‰çš„ç±»å‹å½¢å‚ï¼Œæ‰€ä»¥ç§°å…¶ä¸º**ç±»å‹å½¢å‚åˆ—è¡¨**
- è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª NewType ä¸º Slice[T]

è¿™ç§ç±»å‹å®šä¹‰ä¸­å¸¦ç±»å‹å½¢å‚çš„ç±»å‹ï¼Œç§°ä¹‹ä¸º**æ³›å‹ç±»å‹**

æ³›å‹ç±»å‹ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦ä¼ å…¥**ç±»å‹å®å‚**ï¼Œå³ç±»å‹å½¢å‚åˆ—è¡¨ä¸­çš„ç±»å‹ï¼Œè€Œä¼ å…¥ç±»å‹çš„æ“ä½œè¢«ç§°ä¸º**å®ä¾‹åŒ–**ï¼Œä¾‹å¦‚

```go
// è¿™é‡Œä¼ å…¥äº†ç±»å‹å®å‚ intï¼Œæ³›å‹ç±»å‹ Slice[T] è¢«å®ä¾‹åŒ–äº†å…·ä½“çš„ç±»å‹ä¸º Slice[int]
var a Slice[int] = []int{1, 2, 3}
fmt.Printf("Type Name: %T\n", a)

// è¿™é‡Œè¢«å®ä¾‹åŒ–ä¸ºäº† Slice[string]
var s Slice[string] = []int{"a", "b", "c"}
fmt.Printf("Type Name: %t\n", s)

// errorï¼Œbyte ä¸åœ¨ç±»å‹çº¦æŸä¸­
var b Slice[byte] = []byte{'a', 'b', 'c'}
```

ç±»å‹å½¢å‚çš„æ•°é‡ä¸æ­¢æœ‰ä¸€ä¸ª  ~~è¿™ä¸ªæ³›å‹mapå°±å¼€å§‹åäººç±»äº†ï¼Œè¿™ä¹ˆå¤š`[]`ï¼Œæœ‰ç‚¹çœ¼èŠ±~~

```go
// NewMap å®šä¹‰ä¸¤ä¸ªç±»å‹å½¢å‚ Kï¼Œ V
// è¿™ä¸ªç±»å‹çš„åå­—å°±å«åš: NewMap[K, V]
type NewMap [K int | string, V float32 | falot64] map[KEY]VALUE

var m NewMap[int, float64] = map[int]float64 {
    1: 5.0,
    2: 4.0,
}
```

å…¶ä»–çš„æ³›å‹ç±»å‹

```go
// æ³›å‹ç»“æ„ä½“
type NewStruct[T int | string] struct {
    Name string
    Data T
}

// æ³›å‹æ¥å£
type IPrintData[T int | float64 | string] {
    Print(data T)
}

// æ³›å‹Channel
type NewChan[T int | string] chan T
```

ç±»å‹å½¢å‚ä¹Ÿå¯ä»¥è¿›è¡ŒåµŒå¥—ï¼Œä¾‹å¦‚

```go
type WowStruct[T int | float32, S []T] struct {
    Data S
    MinValue T
    MaxValue T
}

var s WowStruct[int, []int] = {
    Data: []int{1, 2, 3},
    MinValue: 1,
    MaxValue: 100,
}
```

### å¸¸è§è¯­æ³•é”™è¯¯

